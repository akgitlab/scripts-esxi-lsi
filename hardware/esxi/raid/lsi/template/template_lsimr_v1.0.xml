<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>4.4</version>
    <date>2022-02-23T03:39:17Z</date>
    <groups>
        <group>
            <name>Templates/Server hardware</name>
        </group>
    </groups>
    <templates>
        <template>
            <template>Template LSI MegaRAID Controller</template>
            <name>Template LSI MegaRAID Controller</name>
            <groups>
                <group>
                    <name>Templates/Server hardware</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>LSI MegaRAID batterry backup unit</name>
                </application>
                <application>
                    <name>LSI MegaRAID controllers</name>
                </application>
                <application>
                    <name>LSI MegaRAID logical drives</name>
                </application>
                <application>
                    <name>LSI MegaRAID physical drives</name>
                </application>
                <application>
                    <name>Raw data</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>Physical drives raw data</name>
                    <key>lsimr.pd.info[{HOST.HOST}]</key>
                    <delay>10m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>Raw data</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Logical drives raw data</name>
                    <key>lsimr.vd.info[{HOST.HOST}]</key>
                    <delay>10m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>Raw data</name>
                        </application>
                    </applications>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <name>Controllers discovery</name>
                    <key>lsimr.ctl.info[{HOST.HOST}]</key>
                    <delay>1h</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>Controller #{#CTLID} alarm switch state</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.ass[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Состояние переключателя тревоги</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID controllers</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['HwCfg']['Alarm']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / battery average time to full</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.bbu.attf[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Время до полного заряда резервной батареи</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID batterry backup unit</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['BBU_Capacity_Info'][6]['Value']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.bbu.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} backup battery raw data</name>
                            <key>lsimr.ctl.bbu.info[{HOST.HOST},{#CTLID}]</key>
                            <delay>10m</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>Raw data</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]</params>
                                </step>
                                <step>
                                    <type>CHECK_REGEX_ERROR</type>
                                    <params>(&quot;Status&quot;\s:\s&quot;Failure&quot;)
\1</params>
                                </step>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Response Data']</params>
                                </step>
                            </preprocessing>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / battery low charge level</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.bbu.lowcharge[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Уровень заряда резервной батареи</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID batterry backup unit</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['BBU_Firmware_Status'][10]['Value']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.bbu.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{str(No)}=0 and {strlen()}&gt;0</expression>
                                    <name>На контроллере #{#CTLID} низкий уровень заряда резервной батареи</name>
                                    <opdata>{ITEM.LASTVALUE1}</opdata>
                                    <priority>AVERAGE</priority>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>hv</tag>
                                            <value>ctrl</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / battery need to replace</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.bbu.replace[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Необходимость замены резервной батареи</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID batterry backup unit</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['BBU_Firmware_Status'][9]['Value']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.bbu.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>({str(No)}=0 and {strlen()}&gt;0)</expression>
                                    <name>Резервной батарее контроллера #{#CTLID} требуется замена</name>
                                    <opdata>{ITEM.LASTVALUE1}</opdata>
                                    <priority>AVERAGE</priority>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>hv</tag>
                                            <value>ctrl</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / battery relative state of charge</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.bbu.rsoch[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Относительное состояние заряда резервной батареи</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID batterry backup unit</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['BBU_Capacity_Info'][0]['Value']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.bbu.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / battery serial number</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.bbu.sn[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Серийный номер резервной батареи</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID batterry backup unit</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['BBU_Design_Info'][4]['Value']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.bbu.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>({diff()}=1 and {strlen()}&gt;0)</expression>
                                    <name>На контроллере #{#CTLID} произведена замена резервной батареи</name>
                                    <priority>INFO</priority>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>hv</tag>
                                            <value>ctrl</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / battery current state</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.bbu.state[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Состояние здоровья резервной батареи</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID batterry backup unit</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['BBU_Info'][4]['Value']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.bbu.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>({str(Optimal)}=0 and {strlen()}&gt;0)</expression>
                                    <name>На контроллере #{#CTLID} ухудшилось состояние здоровья резервной батареи</name>
                                    <opdata>{ITEM.LASTVALUE}</opdata>
                                    <priority>AVERAGE</priority>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>hv</tag>
                                            <value>ctrl</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / battery temperature</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.bbu.temp[{#CTLID}]</key>
                            <delay>0</delay>
                            <value_type>FLOAT</value_type>
                            <units>°C</units>
                            <description>Температура резервной батареи</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID batterry backup unit</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['BBU_Info'][3]['Value']</params>
                                </step>
                                <step>
                                    <type>TRIM</type>
                                    <params>C</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.bbu.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / battery type</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.bbu.type[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Тип резервной батареи</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID batterry backup unit</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['BBU_Info'][0]['Value']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.bbu.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} onboard battery presence</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.bbu[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Наличие резервной батареи</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID controllers</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['HwCfg']['BBU']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{str(Present)}=0</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{str(Present)}=1</recovery_expression>
                                    <name>На контроллере #{#CTLID} отсутствует резервная батарея</name>
                                    <opdata>{ITEM.LASTVALUE1}</opdata>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>hv</tag>
                                            <value>ctrl</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} onboard port count on backend</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.bpc[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Количество интерфейсных портов внутри</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID controllers</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['HwCfg']['Backend Port Count']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} cache vault size</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.cache[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Размер кэша контроллера</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID controllers</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['HwCfg']['CacheVault Flash Size']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} chip revision</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.chrev[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Ревизия чипа</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID controllers</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['HwCfg']['ChipRevision']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} current size of cache cade</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.csocc[{#CTLID}]</key>
                            <delay>0</delay>
                            <units>GB</units>
                            <description>Используется для повышения производительности произвольного чтения виртуальных дисков на основе жесткого диска</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID controllers</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['HwCfg']['Current Size of CacheCade (GB)']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>3h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} current size of FW cache</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.csofw[{#CTLID}]</key>
                            <delay>0</delay>
                            <units>MB</units>
                            <description>Текущий размер кэш-памяти FW</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID controllers</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['HwCfg']['Current Size of FW Cache (MB)']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>3h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / cache vault need to replace</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.cv.replace[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Необходимость замены</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID batterry backup unit</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Firmware_Status'][1]['Value']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.cvs.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / cache vault serial number</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.cv.sn[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID batterry backup unit</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Design_Info'][1]['Value']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.cvs.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / cache vault current state</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.cv.state[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID batterry backup unit</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Cachevault_Info'][2]['Value']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.cvs.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} cache vault temperature</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.cv.temp[{#CTLID}]</key>
                            <delay>0</delay>
                            <value_type>FLOAT</value_type>
                            <units>°C</units>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID controllers</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Cachevault_Info'][1]['Value']</params>
                                </step>
                                <step>
                                    <type>TRIM</type>
                                    <params>C</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.cvs.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last(#1)}&gt;{$CTRL_BBU_TEMP_AVERAGE}</expression>
                                    <name>Температура резервной батареи контроллера #{#CTLID} превышает {$CTRL_BBU_TEMP_AVERAGE} °C</name>
                                    <opdata>{ITEM.LASTVALUE1}</opdata>
                                    <priority>HIGH</priority>
                                    <tags>
                                        <tag>
                                            <tag>hv</tag>
                                            <value>ctrl</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{last(#1)}&gt;{$CTRL_BBU_TEMP_CRIT}</expression>
                                    <name>Температура резервной батареи контроллера #{#CTLID} превышает {$CTRL_BBU_TEMP_CRIT} °C</name>
                                    <opdata>{ITEM.LASTVALUE1}</opdata>
                                    <priority>DISASTER</priority>
                                    <tags>
                                        <tag>
                                            <tag>hv</tag>
                                            <value>ctrl</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{last(#1)}&gt;{$CTRL_BBU_TEMP_WARNING}</expression>
                                    <name>Температура резервной батареи контроллера #{#CTLID} превышает {$CTRL_BBU_TEMP_WARNING} °C</name>
                                    <opdata>{ITEM.LASTVALUE1}</opdata>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>hv</tag>
                                            <value>ctrl</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{last(#1)}&gt;{$CTRL_ROC_TEMP_AVERAGE}</expression>
                                    <name>Температура чипа контроллера #{#CTLID} превышает {$CTRL_ROC_TEMP_AVERAGE} °C</name>
                                    <opdata>{ITEM.LASTVALUE1}</opdata>
                                    <priority>HIGH</priority>
                                    <tags>
                                        <tag>
                                            <tag>hv</tag>
                                            <value>ctrl</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{last(#1)}&gt;{$CTRL_ROC_TEMP_CRIT}</expression>
                                    <name>Температура чипа контроллера #{#CTLID} превышает {$CTRL_ROC_TEMP_CRIT} °C</name>
                                    <opdata>{ITEM.LASTVALUE1}</opdata>
                                    <priority>DISASTER</priority>
                                    <tags>
                                        <tag>
                                            <tag>hv</tag>
                                            <value>ctrl</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{last(#1)}&gt;{$CTRL_ROC_TEMP_WARNING}</expression>
                                    <name>Температура чипа контроллера #{#CTLID} превышает {$CTRL_ROC_TEMP_WARNING} °C</name>
                                    <opdata>{ITEM.LASTVALUE1}</opdata>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>hv</tag>
                                            <value>ctrl</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / cache vault type</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.cv.type[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID batterry backup unit</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Cachevault_Info'][0]['Value']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.cvs.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} cache vault raw data</name>
                            <key>lsimr.ctl.cvs.info[{HOST.HOST},{#CTLID}]</key>
                            <delay>10m</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>Raw data</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]</params>
                                </step>
                                <step>
                                    <type>CHECK_REGEX_ERROR</type>
                                    <params>(&quot;Status&quot;\s:\s&quot;Failure&quot;)
\1</params>
                                </step>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Response Data']</params>
                                </step>
                            </preprocessing>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} onboard port count on frontend</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.fepc[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Количество интерфейсных портов снаружи</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID controllers</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['HwCfg']['Front End Port Count']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} hardware raw data</name>
                            <key>lsimr.ctl.info[{HOST.HOST},{#CTLID}]</key>
                            <delay>10m</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>Raw data</name>
                                </application>
                            </applications>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{nodata(3h)}=1</expression>
                                    <name>Отсутствуют данные о состоянии контроллеров и дисков массива</name>
                                    <priority>WARNING</priority>
                                    <description>Результат:&#13;
1 - если нет полученных данных за указанный период времени&#13;
0 - в противном случае</description>
                                    <tags>
                                        <tag>
                                            <tag>hv</tag>
                                            <value>data</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} memory size</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.memory[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Объем памяти</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID controllers</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['HwCfg']['On Board Memory Size']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>3h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} model</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.model[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID controllers</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['Basics']['Model']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} onboard expander presence</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.obe[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Наличие встроенного расширителя</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID controllers</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['HwCfg']['On Board Expander']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} chip temperature</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.roctemp[{#CTLID}]</key>
                            <delay>0</delay>
                            <value_type>FLOAT</value_type>
                            <units>°C</units>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID controllers</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['HwCfg']['ROC temperature(Degree Celsius)']</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} onboard serial debugger presence</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.sd[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Наличие отладчика</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID controllers</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['HwCfg']['Serial Debugger']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} serial number</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.sn[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Серийный номер контроллера</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID controllers</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['Basics']['Serial Number']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} current state</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.state[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Текущее состояние контроллера</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID controllers</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['Status']['Controller Status']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} onboard temp sensor for chip presence</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.tsfch[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Наличие температурного сенсора чипа контроллера</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID controllers</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['HwCfg']['Temperature Sensor for ROC']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} onboard temp sensor for controller presence</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.ctl.tsfc[{#CTLID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Наличие температурного сенсора контроллера</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID controllers</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['HwCfg']['Temperature Sensor for Controller']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.ctl.info[{HOST.HOST},{#CTLID}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} physical drives raw data</name>
                            <key>lsimr.pd.info[{HOST.HOST},{#CTLID}]</key>
                            <delay>10m</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>Raw data</name>
                                </application>
                            </applications>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} virtual drives raw data</name>
                            <key>lsimr.vd.info[{HOST.HOST},{#CTLID}]</key>
                            <delay>10m</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>Raw data</name>
                                </application>
                            </applications>
                        </item_prototype>
                    </item_prototypes>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#CTLID}</lld_macro>
                            <path>$.Ctl</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>CHECK_JSON_ERROR</type>
                            <params>$['Controllers'][0]['Command Status']['Detailed Status'][0]['ErrMsg']</params>
                        </step>
                        <step>
                            <type>JSONPATH</type>
                            <params>$['Controllers'][0]['Response Data']['System Overview']</params>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>1h</params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <name>Physical drives discovery</name>
                    <type>DEPENDENT</type>
                    <key>lsimr.pd.lld</key>
                    <delay>0</delay>
                    <lifetime>1d</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <name>Controller #{#CTLID} physical drive {#PDID} ({#EID}) drive raw data</name>
                            <key>lsimr.pd.all.info[{HOST.HOST},{#PDNAME}]</key>
                            <delay>5m</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>Raw data</name>
                                </application>
                            </applications>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) drive group</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.dg[{#PDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Группа физического диска</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['Drive Information'][{#CTLPDID}]['DG']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) device id</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.did[{#PDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Идентификатор устройства в MegaRAID. Эта ассоциация будет сохраняться в течение всего срока службы контроллера, если только она не будет очищена или пока пул идентификаторов не будет исчерпан.</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['Drive Information'][{#CTLPDID}]['DID']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) enclosure device slot number</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.eid[{#PDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Номер слота физического диска</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['Drive Information'][{#CTLPDID}]['EID:Slt']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) current firmware version</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.fw[{#PDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Версия прошивки физического диска</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['Drive {#PDNAME} - Detailed Information']['Drive {#PDNAME} Device attributes']['Firmware Revision']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.all.info[{HOST.HOST},{#PDNAME}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) interface type</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.intf[{#PDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Интерфейс физического диска</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['Drive Information'][{#CTLPDID}]['Intf']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) media error count</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.media.error.count[{#PDID}]</key>
                            <delay>0</delay>
                            <description>Количество ошибок носителя</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['Drive {#PDNAME} - Detailed Information']['Drive {#PDNAME} State']['Media Error Count']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.all.info[{HOST.HOST},{#PDNAME}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{change()}&gt;0</expression>
                                    <name>На диске #{#PDID} [{#EID}] контроллера #{#CTLID} обнаружены ошибки носителя</name>
                                    <opdata>Кол-во ошибок: {ITEM.LASTVALUE1}</opdata>
                                    <priority>WARNING</priority>
                                    <tags>
                                        <tag>
                                            <tag>hv</tag>
                                            <value>ctrl</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) media type</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.med[{#PDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Тип диска</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['Drive Information'][{#CTLPDID}]['Med']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) model</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.model[{#PDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Модель физического диска</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['Drive Information'][{#CTLPDID}]['Model']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) name</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.name[{#PDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Имя физического диска</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['Drive Information'][{#CTLPDID}]['EID:Slt']</params>
                                </step>
                                <step>
                                    <type>REGEX</type>
                                    <params>^(.*)$
{#PDNAME}</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) other error count</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.other.error.count[{#PDID}]</key>
                            <delay>0</delay>
                            <description>Прочее количество ошибок</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['Drive {#PDNAME} - Detailed Information']['Drive {#PDNAME} State']['Other Error Count']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.all.info[{HOST.HOST},{#PDNAME}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{change()}&gt;0</expression>
                                    <name>На диске #{#PDID} [{#EID}] контроллера #{#CTLID} обнаружены ошибки</name>
                                    <opdata>Кол-во ошибок: {ITEM.LASTVALUE1}</opdata>
                                    <priority>WARNING</priority>
                                    <tags>
                                        <tag>
                                            <tag>hv</tag>
                                            <value>ctrl</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) protection info</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.pi[{#PDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Функция защиты данных - это дополнительный метод предотвращения повреждения данных за счет обеспечения сквозной целостности данных на всем пути ввода-вывода от приложения к диску.</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['Drive Information'][{#CTLPDID}]['PI']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) predictive failure count</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.predictive.failure.count[{#PDID}]</key>
                            <delay>0</delay>
                            <description>Прогнозируемое количество отказов</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['Drive {#PDNAME} - Detailed Information']['Drive {#PDNAME} State']['Predictive Failure Count']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.all.info[{HOST.HOST},{#PDNAME}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&gt;0</expression>
                                    <name>Прогнозируемое количество отказов диска #{#PDID} [{#EID}] на контроллере #{#CTLID} увеличилось</name>
                                    <opdata>Кол-во отказов: {ITEM.LASTVALUE1}</opdata>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>hv</tag>
                                            <value>ctrl</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) self encryptive drive</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.sed[{#PDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Шифрование физического диска</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['Drive Information'][{#CTLPDID}]['SED']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) sector size</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.sesz[{#PDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Размер сектора физического диска</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['Drive Information'][{#CTLPDID}]['SeSz']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) shield counter</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.shield.counter[{#PDID}]</key>
                            <delay>0</delay>
                            <description>Количество переключений диска в состояние защиты (в случае&#13;
сбоя физического диска он переводится в состояние защиты, а&#13;
контроллер MegaRAID запускает диагностику, чтобы определить, действительно ли диск вышел из строя или его можно восстановить).</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['Drive {#PDNAME} - Detailed Information']['Drive {#PDNAME} State']['Shield Counter']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.all.info[{HOST.HOST},{#PDNAME}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) size</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.size[{#PDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Объем физического диска</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['Drive Information'][{#CTLPDID}]['Size']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) self monitoring alert flag</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.smart.alert.flag[{#PDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Сообщение об оценке состояния жёсткого диска встроенной аппаратурой самодиагностики</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['Drive {#PDNAME} - Detailed Information']['Drive {#PDNAME} State']['S.M.A.R.T alert flagged by drive']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.all.info[{HOST.HOST},{#PDNAME}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{str(No)}=0 and {strlen()}&gt;0</expression>
                                    <name>Оценка состояния диска #{#PDID} [{#EID}] контроллера #{#CTLID} изменилась</name>
                                    <opdata>Флаг оповещения: {ITEM.LASTVALUE1}</opdata>
                                    <priority>HIGH</priority>
                                    <tags>
                                        <tag>
                                            <tag>hv</tag>
                                            <value>ctrl</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) serial number</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.sn[{#PDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Серийный номер физического диска</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['Drive {#PDNAME} - Detailed Information']['Drive {#PDNAME} Device attributes']['SN']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.all.info[{HOST.HOST},{#PDNAME}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) spun</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.spun[{#PDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Текущее состояние диска: показывает Up, когда диск раскручивается и Down, когда привод заглох (диски SSD и другие диски, которые никогда не останавливаются, всегда в состоянии Up).</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['Drive Information'][{#CTLPDID}]['Sp']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <params>switch(value)
{
case 'Onln':
value='Online';
break;
case 'UGood':
value='Unconfigured-Good';
break;
case 'UBad':
value='Unconfigured-Bad';
break;
case 'Msng':
value='Missing';
break;
case 'Offln':
value='Offline';
break;
case 'GHS':
value='Global Hot Spare';
break;
case 'DHS':
value='Dedicated Hot Spare';
break;
case 'Rbld':
value='Rebuild';
break;
case 'U':
value='Up';
break;
case 'D':
value='Down/PowerSave';
break;
case 'T':
value='Transition';
break;
case 'F':
value='Foreign';
break;
case 'UGUnsp':
value='Unsupported';
break;
case 'UGShld':
value='UnConfigured shielded';
break;
case 'HSPShld':
value='Hotspare shielded';
break;
case 'CFShld':
value='Configured shielded';
break;
case 'Cpybck':
value='CopyBack';
break;
case 'CBShld':
value='Copyback Shielded';
break;
}
return value</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) current state</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.state[{#PDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Состояние здоровья физического диска</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['Drive Information'][{#CTLPDID}]['State']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <params>switch(value)
{
case 'Onln':
value='Online';
break;
case 'UGood':
value='Unconfigured-Good';
break;
case 'UBad':
value='Unconfigured-Bad';
break;
case 'Msng':
value='Missing';
break;
case 'Offln':
value='Offline';
break;
case 'GHS':
value='Global Hot Spare';
break;
case 'DHS':
value='Dedicated Hot Spare';
break;
case 'Rbld':
value='Rebuild';
break;
case 'U':
value='Up';
break;
case 'D':
value='Down/PowerSave';
break;
case 'T':
value='Transition';
break;
case 'F':
value='Foreign';
break;
case 'UGUnsp':
value='Unsupported';
break;
case 'UGShld':
value='UnConfigured shielded';
break;
case 'HSPShld':
value='Hotspare shielded';
break;
case 'CFShld':
value='Configured shielded';
break;
case 'Cpybck':
value='CopyBack';
break;
case 'CBShld':
value='Copyback Shielded';
break;
}
return value</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.info[{HOST.HOST}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>({str(Unconfigured-Bad)}=1 &#13;
or {str(Unconfigured-Good)}=1 &#13;
or {str(Missing)}=1 &#13;
or {str(Offline)}=1 &#13;
or {str(Foreign)}=1) &#13;
and {strlen()}&gt;0</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{str(Unconfigured-Good)}=1 or {str(Online)}=1</recovery_expression>
                                    <name>Состояние диска #{#PDID} [{#EID}] на контроллере #{#CTLID} изменилось</name>
                                    <opdata>Текущее состояние: {ITEM.LASTVALUE}</opdata>
                                    <priority>HIGH</priority>
                                    <tags>
                                        <tag>
                                            <tag>hv</tag>
                                            <value>ctrl</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) temperature</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.temp[{#PDID}]</key>
                            <delay>0</delay>
                            <units>°C</units>
                            <description>Температура физического диска</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][0]['Response Data']['Drive {#PDNAME} - Detailed Information']['Drive {#PDNAME} State']['Drive Temperature']</params>
                                </step>
                                <step>
                                    <type>REGEX</type>
                                    <params>^(.+)C.*$
\1</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.all.info[{HOST.HOST},{#PDNAME}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / physical drive #{#PDID}: ({#EID}) type</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.pd.type[{#PDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Тип физического диска</description>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID physical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['Drive Information'][{#CTLPDID}]['Type']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <params>switch(value)
{
case 'Onln':
value='Online';
break;
case 'UGood':
value='Unconfigured-Good';
break;
case 'UBad':
value='Unconfigured-Bad';
break;
case 'Msng':
value='Missing';
break;
case 'Offln':
value='Offline';
break;
case 'GHS':
value='Global Hot Spare';
break;
case 'DHS':
value='Dedicated Hot Spare';
break;
case 'Rbld':
value='Rebuild';
break;
case 'U':
value='Up';
break;
case 'D':
value='Down/PowerSave';
break;
case 'T':
value='Transition';
break;
case 'F':
value='Foreign';
break;
case 'UGUnsp':
value='Unsupported';
break;
case 'UGShld':
value='UnConfigured shielded';
break;
case 'HSPShld':
value='Hotspare shielded';
break;
case 'CFShld':
value='Configured shielded';
break;
case 'Cpybck':
value='CopyBack';
break;
case 'CBShld':
value='Copyback Shielded';
break;
}
return value</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.pd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                    </item_prototypes>
                    <master_item>
                        <key>lsimr.pd.info[{HOST.HOST}]</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#CTLID}</lld_macro>
                            <path>$.CTLID</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#CTLPDID}</lld_macro>
                            <path>$.CTLPDID</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#EID}</lld_macro>
                            <path>$.['EID:Slt']</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#PDID}</lld_macro>
                            <path>$.PDID</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#PDNAME}</lld_macro>
                            <path>$.PDNAME</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JAVASCRIPT</type>
                            <params>var i=0;
var NeedData = [];
var JsonValue = JSON.parse(value);
var Controllers = JsonValue.Controllers;
for (var keyC in Controllers) {
	if (JsonValue.Controllers[keyC]['Response Data'] &amp;&amp; JsonValue.Controllers[keyC]['Response Data']['Drive Information']) {
		var DriveInformation = JsonValue.Controllers[keyC]['Response Data']['Drive Information'];
		for (var key in DriveInformation) {       
 		 	JsonValue.Controllers[keyC]['Response Data']['Drive Information'][key]['PDID'] = i;
 		 	JsonValue.Controllers[keyC]['Response Data']['Drive Information'][key]['PDNAME'] = '/c' + keyC + '/e' + JsonValue.Controllers[keyC]['Response Data']['Drive Information'][key]['EID:Slt'].replace(':','/s');
 		 	JsonValue.Controllers[keyC]['Response Data']['Drive Information'][key]['CTLPDID'] = key;
 		 	JsonValue.Controllers[keyC]['Response Data']['Drive Information'][key]['CTLID'] = keyC;
 		 	NeedData[i] = JsonValue.Controllers[keyC]['Response Data']['Drive Information'][key];
 		 	i = i + 1;
		}
	}
}
return JSON.stringify(NeedData)</params>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>1h</params>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <name>Logical drives discovery</name>
                    <type>DEPENDENT</type>
                    <key>lsimr.vd.lld</key>
                    <delay>0</delay>
                    <lifetime>1d</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <name>Controller #{#CTLID} / virtual drive #{#LDNAME}: ({#LDID}) cache</name>
                            <type>DEPENDENT</type>
                            <key>lsi.vd.cache[{#LDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID logical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['{#LDID}'][0]['Cache']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.vd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / virtual drive #{#LDNAME}: ({#LDID}) access</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.vd.access[{#LDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID logical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['{#LDID}'][0]['Access']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.vd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / virtual drive #{#LDNAME}: ({#LDID}) cache cade</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.vd.cac[{#LDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID logical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['{#LDID}'][0]['Cac']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.vd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / virtual drive #{#LDNAME}: ({#LDID}) consistency</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.vd.consist[{#LDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID logical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['{#LDID}'][0]['Consist']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.vd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / virtual drive #{#LDNAME}: ({#LDID}) drive / volume groups</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.vd.dgvd[{#LDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID logical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['{#LDID}'][0]['DG/VD']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.vd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / virtual drive #{#LDNAME}: ({#LDID}) level</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.vd.level[{#LDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID logical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['{#LDID}'][0]['TYPE']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.vd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / virtual drive #{#LDNAME}: ({#LDID}) scheduled check consistency</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.vd.scc[{#LDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID logical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['{#LDID}'][0]['sCC']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.vd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / virtual drive #{#LDNAME}: ({#LDID}) size</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.vd.size[{#LDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID logical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['{#LDID}'][0]['Size']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.vd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Controller #{#CTLID} / virtual drive #{#LDNAME}: ({#LDID}) current state</name>
                            <type>DEPENDENT</type>
                            <key>lsimr.vd.state[{#LDID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>LSI MegaRAID logical drives</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$['Controllers'][{#CTLID}]['Response Data']['{#LDID}'][0]['State']</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <params>switch(value)
{
case 'Optl':
value='Optimal';
break;
case 'OfLn':
value='Offline';
break;
case 'Pdgd':
value='Partially degraded';
break;
case 'Dgrd':
value='Degraded';
break;
case 'Rec':
value='Recovery';
break;
}
return value</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>lsimr.vd.info[{HOST.HOST}]</key>
                            </master_item>
                        </item_prototype>
                    </item_prototypes>
                    <master_item>
                        <key>lsimr.vd.info[{HOST.HOST}]</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#CTLID}</lld_macro>
                            <path>$.CTLID</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#LDID}</lld_macro>
                            <path>$.LDID</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#LDNAME}</lld_macro>
                            <path>$.Name</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>JAVASCRIPT</type>
                            <params>var i=0;
var NeedData = [];
var JsonValue = JSON.parse(value);
var Controllers = JsonValue.Controllers;
for (var keyC in Controllers) {
  var ResponseStatus=JsonValue.Controllers[keyC]['Command Status']['Status'];
  if (ResponseStatus.match(/Success/g)) {  	
		var ResponseData = JsonValue.Controllers[keyC]['Response Data'];
		for (var key in ResponseData) {
			if (key.match(/\/c\d{1,}\/v\d{1,}/g)) {
	 		 	JsonValue.Controllers[keyC]['Response Data'][key][0]['LDID'] = key;
	 		 	JsonValue.Controllers[keyC]['Response Data'][key][0]['CTLID'] = keyC;
	 		 	NeedData[i] = JsonValue.Controllers[keyC]['Response Data'][key][0];
	 		 	i = i + 1;
			}
    }
  	
  }
}
return JSON.stringify(NeedData)</params>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>1h</params>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
            <macros>
                <macro>
                    <macro>{$CTRL_BBU_TEMP_AVERAGE}</macro>
                    <value>45</value>
                    <description>Значение в °C</description>
                </macro>
                <macro>
                    <macro>{$CTRL_BBU_TEMP_CRIT}</macro>
                    <value>60</value>
                    <description>Значение в °C</description>
                </macro>
                <macro>
                    <macro>{$CTRL_BBU_TEMP_WARNING}</macro>
                    <value>40</value>
                    <description>Значение в °C</description>
                </macro>
                <macro>
                    <macro>{$CTRL_PD_TEMP_AVERAGE}</macro>
                    <value>50</value>
                    <description>Значение в °C</description>
                </macro>
                <macro>
                    <macro>{$CTRL_PD_TEMP_CRIT}</macro>
                    <value>60</value>
                    <description>Значение в °C</description>
                </macro>
                <macro>
                    <macro>{$CTRL_PD_TEMP_WARNING}</macro>
                    <value>45</value>
                    <description>Значение в °C</description>
                </macro>
                <macro>
                    <macro>{$CTRL_ROC_TEMP_AVERAGE}</macro>
                    <value>80</value>
                    <description>Значение в °C</description>
                </macro>
                <macro>
                    <macro>{$CTRL_ROC_TEMP_CRIT}</macro>
                    <value>90</value>
                    <description>Значение в °C</description>
                </macro>
                <macro>
                    <macro>{$CTRL_ROC_TEMP_WARNING}</macro>
                    <value>70</value>
                    <description>Значение в °C</description>
                </macro>
            </macros>
        </template>
    </templates>
</zabbix_export>
